<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Admin Panel - Skylon Timber & Glazing House" />
    <title>Admin Panel | Skylon Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Raleway:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/admin-dashboard.css">
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <h1>SKYLON</h1>
                <p>Admin Panel</p>
            </div>
            
            <nav class="admin-nav">
                <button class="nav-btn active" data-view="dashboard">
                    <span class="nav-icon">ðŸ“Š</span>
                    <span class="nav-text">Dashboard</span>
                </button>
                <button class="nav-btn" data-view="customers">
                    <span class="nav-icon">ðŸ‘¥</span>
                    <span class="nav-text">Customers</span>
                </button>
                <button class="nav-btn" data-view="orders">
                    <span class="nav-icon">ðŸ“¦</span>
                    <span class="nav-text">Orders</span>
                </button>
                <button class="nav-btn" data-view="analytics">
                    <span class="nav-icon">ðŸ“ˆ</span>
                    <span class="nav-text">Analytics</span>
                </button>
                <button class="nav-btn" data-view="pricing">
                    <span class="nav-icon">ðŸ’°</span>
                    <span class="nav-text">Pricing Config</span>
                </button>
            </nav>

            <div class="admin-footer">
                <button id="admin-logout" class="logout-btn">
                    <span class="nav-icon">ðŸšª</span>
                    <span class="nav-text">Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Header -->
            <header class="admin-header">
                <div class="header-left">
                    <h2 id="view-title">Dashboard</h2>
                </div>
                <div class="header-right">
                    <div class="admin-user">
                        <span id="admin-name">Admin</span>
                    </div>
                </div>
            </header>

            <!-- Dashboard View -->
            <div id="dashboard-view" class="admin-view active">
                <div class="stats-overview">
                    <div class="stat-box">
                        <div class="stat-icon">ðŸ‘¥</div>
                        <div class="stat-info">
                            <div class="stat-value" id="total-customers">0</div>
                            <div class="stat-label">Total Customers</div>
                        </div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-icon">ðŸ“‹</div>
                        <div class="stat-info">
                            <div class="stat-value" id="total-estimates">0</div>
                            <div class="stat-label">Total Estimates</div>
                        </div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-icon">ðŸ“¦</div>
                        <div class="stat-info">
                            <div class="stat-value" id="active-orders">0</div>
                            <div class="stat-label">Active Orders</div>
                        </div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-icon">ðŸ’°</div>
                        <div class="stat-info">
                            <div class="stat-value" id="total-revenue">Â£0</div>
                            <div class="stat-label">Total Revenue</div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>Recent Orders</h3>
                        <div id="recent-orders-list">Loading...</div>
                    </div>
                    <div class="dashboard-card">
                        <h3>Quick Actions</h3>
                        <div class="quick-actions-list">
                            <button class="action-btn" onclick="adminPanel.switchView('orders')">View All Orders</button>
                            <button class="action-btn" onclick="adminPanel.switchView('customers')">Manage Customers</button>
                            <button class="action-btn" onclick="adminPanel.switchView('analytics')">View Analytics</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customers View -->
            <div id="customers-view" class="admin-view">
                <div class="view-header">
                    <div class="search-bar">
                        <input type="text" id="customer-search" placeholder="Search customers by name or email...">
                    </div>
                    <button class="btn" onclick="adminPanel.exportCustomers()">Export CSV</button>
                </div>
                <div class="table-container">
                    <table class="admin-table" id="customers-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Registered</th>
                                <th>Orders</th>
                                <th>Estimates</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customers-tbody">
                            <tr><td colspan="7" class="loading">Loading customers...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Orders View -->
            <div id="orders-view" class="admin-view">
                <div class="view-header">
                    <div class="filter-group">
                        <button class="filter-btn active" data-status="all">All</button>
                        <button class="filter-btn" data-status="estimate">Estimates</button>
                        <button class="filter-btn" data-status="confirmed">Confirmed</button>
                        <button class="filter-btn" data-status="production">Production</button>
                        <button class="filter-btn" data-status="transport">Transport</button>
                        <button class="filter-btn" data-status="completed">Completed</button>
                    </div>
                    <button class="btn" onclick="adminPanel.exportOrders()">Export CSV</button>
                </div>
                <div class="table-container">
                    <table class="admin-table" id="orders-table">
                        <thead>
                            <tr>
                                <th>Order #</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Deposit</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="orders-tbody">
                            <tr><td colspan="8" class="loading">Loading orders...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics View -->
            <div id="analytics-view" class="admin-view">
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>Conversion Funnel</h3>
                        <div class="funnel-stats">
                            <div class="funnel-step">
                                <span class="funnel-label">Visitors</span>
                                <span class="funnel-value" id="analytics-visitors">0</span>
                            </div>
                            <div class="funnel-arrow">â–¼</div>
                            <div class="funnel-step">
                                <span class="funnel-label">Registrations</span>
                                <span class="funnel-value" id="analytics-registrations">0</span>
                                <span class="funnel-percent" id="reg-percent">0%</span>
                            </div>
                            <div class="funnel-arrow">â–¼</div>
                            <div class="funnel-step">
                                <span class="funnel-label">Estimates Created</span>
                                <span class="funnel-value" id="analytics-estimates">0</span>
                                <span class="funnel-percent" id="est-percent">0%</span>
                            </div>
                            <div class="funnel-arrow">â–¼</div>
                            <div class="funnel-step">
                                <span class="funnel-label">Orders Placed</span>
                                <span class="funnel-value" id="analytics-orders">0</span>
                                <span class="funnel-percent" id="ord-percent">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3>Revenue Overview</h3>
                        <div class="revenue-stats">
                            <div class="revenue-item">
                                <span>Total Revenue:</span>
                                <strong id="revenue-total">Â£0</strong>
                            </div>
                            <div class="revenue-item">
                                <span>Average Order Value:</span>
                                <strong id="revenue-avg">Â£0</strong>
                            </div>
                            <div class="revenue-item">
                                <span>This Month:</span>
                                <strong id="revenue-month">Â£0</strong>
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3>Popular Products</h3>
                        <div id="popular-products">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Pricing Config View -->
            <div id="pricing-view" class="admin-view">
                <div class="config-section">
                    <h3>Base Pricing</h3>
                    <div class="config-grid">
                        <div class="config-item">
                            <label>Base Price (Â£):</label>
                            <input type="number" id="config-base-price" value="300">
                        </div>
                        <div class="config-item">
                            <label>Price per mÂ² (Â£):</label>
                            <input type="number" id="config-sqm-price" value="150">
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <h3>Multipliers</h3>
                    <div id="multipliers-config">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>

                <div class="config-actions">
                    <button class="btn" onclick="adminPanel.savePricingConfig()">Save Changes</button>
                    <button class="btn-secondary" onclick="adminPanel.resetPricingConfig()">Reset to Default</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Order Edit Modal -->
    <div id="order-edit-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" onclick="adminPanel.closeOrderModal()">&times;</span>
            <div id="order-edit-content">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/supabase-config.js"></script>
    <script src="js/admin-panel-controller.js"></script>
</body>
</html>
